# Copyright (C) 2019 Istituto Italiano di Tecnologia (IIT). All rights reserved.
# This software may be modified and distributed under the terms of the
# GNU Lesser General Public License v2.1 or any later version.

set(LIBRARY_TARGET_NAME BipedalLocomotionControllers)

# Read the properties
get_property(${LIBRARY_TARGET_NAME}_ALL_TARGETS GLOBAL PROPERTY BipedalLocomotionControllers_TARGETS)
get_property(${LIBRARY_TARGET_NAME}_ALL_INCLUDES GLOBAL PROPERTY BipedalLocomotionControllers_INCLUDES)

# Populate the autogenerated header
foreach(file_name ${${LIBRARY_TARGET_NAME}_ALL_INCLUDES})
  # Take only the header files (avoid to use the .*.tpp files)
  if(${file_name} MATCHES ".*.h$")
    # Replace "include/" with ""
    string(REPLACE "include/" "" file_name ${file_name})

    # Append the preprocessor directives
    set(CMAKE_INCLUDE_FILES "${CMAKE_INCLUDE_FILES}\n#include \<${file_name}\>")
  endif()
endforeach(file_name)

# Configure the autogenerated file
configure_file("${PROJECT_SOURCE_DIR}/cmake/BipedalLocomotionControllers.in"
  "${CMAKE_CURRENT_BINARY_DIR}/BipedalLocomotionControllers/BipedalLocomotionControllers.h"
  @ONLY
)
unset(CMAKE_INCLUDE_FILES)

# Generate the library
set(${LIBRARY_TARGET_NAME}_HDR
  ${CMAKE_CURRENT_BINARY_DIR}/BipedalLocomotionControllers/BipedalLocomotionControllers.h)
add_library(${LIBRARY_TARGET_NAME} INTERFACE)
target_link_libraries(${LIBRARY_TARGET_NAME} INTERFACE ${${LIBRARY_TARGET_NAME}_ALL_TARGETS})

# Specify include directories for both compilation and installation process.
# The $<INSTALL_PREFIX> generator expression is useful to ensure to create
# relocatable configuration files, see https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html#creating-relocatable-packages
target_include_directories(${LIBRARY_TARGET_NAME} INTERFACE "$<BUILD_INTERFACE:${CMAKE_CURRENT_BINARY_DIR}/BipedalLocomotionControllers>"
  "$<INSTALL_INTERFACE:$<INSTALL_PREFIX>/${CMAKE_INSTALL_INCLUDEDIR}>")

# Specify installation targets, typology and destination folders.
install(TARGETS    ${LIBRARY_TARGET_NAME}
  EXPORT           ${PROJECT_NAME}
  COMPONENT        runtime)

install(FILES ${${LIBRARY_TARGET_NAME}_HDR}
  DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}/BipedalLocomotionControllers")

set_property(GLOBAL APPEND PROPERTY BipedalLocomotionControllers_TARGETS ${LIBRARY_TARGET_NAME})

message(STATUS "Created target ${LIBRARY_TARGET_NAME} for export ${PROJECT_NAME}.")
